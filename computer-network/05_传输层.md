# 传输层

## 传输层提供的服务

**知识总览**：

<img src="../images/image-202601071855.webp" style="zoom:50%;" />

### 传输层在协议栈中的位置

<img src="../images/image-202601071858.webp" style="zoom:50%;" />

### 传输层“端口号”的概念

<img src="../images/image-202601071904.webp" style="zoom:50%;" />

<span style="color:#FF9A00; font-weight:bold">IP 地址 + 端口号 → 指向网络中一台主机上的一个特定的进程</span>

<span style="color:#5D688A">网络层</span>实现了“<u>主机到主机</u>”的通信。网络层在 IP 数据报的首部，指明<span style="color:#5D688A">源 IP 地址、目的 IP 地址</span>。

<span style="color:#C71E64">传输层</span>实现了“<u>端到端</u>”（<u>进程到进程</u>）的通信。传输层在 TCP（或 UDP）报文段的首部，指明<span style="color:#C71E64">源端口、目的端口</span>。

### 进程、端口号、传输层协议之间的关系

<span style="color:#B9375D"><span style="font-weight:bold">假设</span>：进程 1、5 正在用 TCP 通信；2、6 正在用 TCP 通信；3、7 正在用 UDP 通信；4、8 正在用 UDP 通信。</span>

<img src="../images/image-202601071949.webp" style="zoom:50%;" />

**注意**：

- <span style="color:#932F67">两台主机的端口号是相互独立的。</span>
- <span style="color:#34699A; font-weight:bold">TCP、UDP 的端口号也是相互独立的。</span>
- 当两个进程之间想要通信时，需要指明：
  1. 使用哪种传输层协议。
  2. 本进程绑定的端口号。
  3. 对方的 IP 地址和端口号。

<span style="color:#FF894F">套接字（Socket）= `(IP 地址 : 端口号)`。</span>（分为 TCP 套接字、UDP 套接字）

### 熟知端口号

|    应用程序    | FTP  | TELNET | SMTP | DNS  | TFTP | HTTP | SNMP |
| :------------: | :--: | :----: | :--: | :--: | :--: | :--: | :--: |
| **熟知端口号** |  21  |   23   |  25  |  53  |  69  |  80  | 161  |

0~1023 为熟知端口号，开发的时候一般不使用。

其他端口号在实际开发时并没有特别严格的限制，只要在本机没有被使用的端口号都可以使用。

<span style="color:#FF2DD1">端口号分类只是一种“建议标准”，而非“强制标准”。</span>

### 有连接的传输 vs. 无连接的传输

<img src="../images/image-202601072102.webp" style="zoom:50%;" />

- <span style="color:#ED3500; font-weight:bold">有连接</span>：传输前先打招呼，先<span style="color:#568F87">确认对方已经准备好接收数据</span>。传输结束时，也要<span style="color:#568F87">告知对方已结束</span>。
- <span style="color:#001BB7; font-weight:bold">无连接</span>：不打招呼，直接把数据传给对方。

### 可靠的传输 vs. 不可靠的传输

<img src="../images/image-202601072108.webp" style="zoom:50%;" />

- <span style="color:#B33791; font-weight:bold">可靠的</span>：接收方使用“确认机制”让发送方知道哪些数据已被正确接收。
- <span style="color:#FF9898; font-weight:bold">不可靠的</span>：接收方无论收没收到数据、数据是否正确，都不给发送方反馈。

## UDP 数据报

### UPD 协议、UDP 数据报、UDP 首部

- UDP 首部很小，只占 8B。
- UDP 每次传输一个完整的报文，不支持报文自动拆分、重装。
- UDP 是无连接的、不可靠的（可靠性可交给应用层处理），也不支持拥塞控制。
- UDP 支持一对一（封装成单播 IP 数据报）、一对多传输（封装成广播/多播 IP 数据报）。
