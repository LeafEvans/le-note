# 计算机网络体系结构

## 计算机网络的概念

**知识总览**：

<img src="../images/image-202509162043.svg"  />

### 计算机网络的定义

<span style="color:#6F00FF; font-weight:bold">计算机网络（Computer Networking）</span>是一个将众多<span style="color:#E45A92">分散的</span>、<span style="color:#E45A92">自治的</span>计算机系统，通过<span style="color:#3A6F43">通信设备</span>（路由器、5G 基站等）与<span style="color:#4FB7B3">线路</span>连接起来，由功能完善的<span style="color:#B45253">软件</span>实现<span style="color:#E45A92">资源共享</span>和<span style="color:#E45A92">信息传递</span>的系统。

<img src="../images/image-202509162051.webp" style="zoom: 50%;" />

### 计算机网络、互连网、互联网的区别

1. **计算机网络（Computer Networking）**
2. **互连网（internet）**
3. **互联网（或因特网，Internet）**

以下提到的“网”指的是哪个网？

1. “我们家宽带欠费，断**网**了”
2. “好兄弟，要不要一起去上**网**”
3. “想把手机投屏到电视上，需要将手机、电视连接到同一**网络**”
4. “银行工作人员需要登录银行**内网**才能给客户办理业务”

### 一个最简单的计算机网络

**计算机网络（简称网络）**：由若干<span style="color:#DC143C">结点（node；结点可以是计算机、集线器、交换机、路由器等。）</span>和连接这些结点的<span style="color:#EF7722">链路（link；链路可以是有线链路、无线链路。）</span>组成。

<img src="../images/image-202509162102.webp" style="zoom:50%;" />

因此可以使用**集线器（Hub）**：

<img src="../images/image-202509162104.webp" style="zoom:50%;" />

**集线器（Hub）**：

- 可以把**多个结点连接起来，组成一个计算机网络**。
- 普通民用领域已很少用集线器。
- “集线器“工作在<span style="color:#F7A5A5; font-weight:bold">物理层</span>。

> [!TIP]
>
> 集线器不能避免<u>数据冲突</u>；例如两台电脑同时发出数据，在集线器处发生数据冲突，最终导致数据传输失败，导致网络卡顿。

通常现在搭建一个计算机网络，不会使用集线器，而是采用**交换机（Switch）**：

<img src="../images/image-202509162113.webp" style="zoom:50%;" />

**交换机（Switch）**：

- 可以把**多个结点连接起来，组成一个计算机网络**。
- 家庭、公司、学校通常用交换机组建内部网络。
- “交换机”工作在<span style="color:#B87C4C; font-weight:bold">数据链路层</span>。

> [!TIP]
>
> <span style="color:#687FE5; font-weight:bold">交换机（Switch）</span>不会出现数据冲突的问题。

### 互连网（internet）

为了将多个计算机网络互通，使用到**路由器（Router）**：

<img src="../images/image-202509162124.svg" style="zoom:80%;" />

**路由器（Router）**：

- 可以**把两个或多个计算机网络互相连接起来**，形成规模。
- 更大的计算机网络，也可称为“互连网”。
- 路由器工作在<span style="color:#AF3E3E; font-weight:bold">网络层</span>。

### 例子：某银行的内部网络（互连网）

<img src="../images/image-202509162145.svg" style="zoom:80%;" />

### 例子：家庭内部网络

<img src="../images/image-202509162152.webp" style="zoom: 50%;" />

> [!TIP]
>
> 一般指的“路由器”和“家用路由器”有一些区别。
> $$
> 家用路由器 = 路由器 + 交换机 + 其他功能
> $$

**思考：怎样才能使用“电视投屏”的功能？**

手机和电视连接到<u>同一个网络</u>。

<img src="../images/image-202509171009.webp" style="zoom:50%;" />

### 互联网（或因特网，Internet）

**ISP（Internet Service Provider）**，即互联网服务提供商（如中国电信、中国移动、中国联通等）。

互联网（或因特网，Internet）是各大 ISP 和国际机构组建的，覆盖全球范围的互连网（internet）。

**互联网**必须使用 <span style="color:#E45A92">TCP/IP 协议</span>通信，**互连网**可使用<span style="color:#E45A92">任意协议</span>通信。

<img src="../images/image-202509171031.svg" style="zoom:80%;" />

### 如何理解“TCP/IP”协议？

<img src="../images/image-202509171034.webp" style="zoom:50%;" />

秦始皇统一六国后，车同轨、书同文、统一度量衡。

---

**知识回顾**：

<img src="../images/image-202509171039.webp" style="zoom: 67%;" />

## 计算机网络的组成、功能

**知识总览**：

<img src="../images/image-202509171043.png" style="zoom:80%;" />

### 计算机网络的组成：从组成部分来看

<img src="../images/image-202509171046.png" style="zoom:67%;" />

#### 硬件、软件、协议

<img src="../images/image-202509182153.png" style="zoom:67%;" />

> [!TIP]
>
> 除了上述这些硬件之外，每个网络<span style="color:#FFA09B; font-weight:bold">内部</span>可能使用：集线器、交换机、路由器、调制解调器、无线基站、网线、光纤等各种设备或线路。

#### 拓展：网络适配器

<span style="color:#A19AD3; font-weight:bold">有线网络适配器</span>：

<img src="../images/image-202509182216.jpg" style="zoom: 25%;" />

<span style="color:#A19AD3; font-weight:bold">无线网络适配器</span>：

<img src="../images/image-202509182228.webp" style="zoom: 67%;" />

### 计算机网络的组成：从工作方式看

<img src="../images/image-202509182244.png" style="zoom: 60%;" />

#### 计算机网络的组成

<img src="../images/image-202509182255.webp" style="zoom: 60%;" />

> [!tip]
>
> **交换服务**就是<span style="color:#6F00FF">动态地</span>去选择数据在网络中传输的路径，以保证各条路径都不会<span style="color:#3A6F43">负担太重</span>。

### 计算机网络的组成：从逻辑功能看

<img src="../images/image-202509190829.webp" style="zoom: 60%;" />

#### 资源子网、通信子网

<img src="../images/image-202509190844.webp" style="zoom: 60%;" />

### 计算机网络的功能

<img src="../images/image-202509190846.png" style="zoom: 60%;" />

#### 计算机网络的功能：数据通信

<img src="../images/image-202509190852.webp" style="zoom:60%;" />

 #### 计算机网络的功能：资源共享

<img src="../images/image-202509190901.png" style="zoom:80%;" />

#### 计算机网络的功能：分布式处理

<img src="../images/image-202509190944.webp" style="zoom: 65%;" />

#### 计算机网络的功能：提高可靠性

<img src="../images/image-202509190954.png" style="zoom:65%;" />

网络中的<span style="color:#F66E00; font-weight:bold">各台计算机</span>互为<span style="color:#191BA9; font-weight:bold">替代机</span>。

#### 计算机网络的功能：负载均衡

<img src="../images/image-202509191156.png" style="zoom:65%;" />

上述例子中的服务器 A 专门负责对战匹配。

---

**知识回顾**：

<img src="../images/image-202509191159.png" style="zoom:80%;" />

## 电报交换、报文交换、分组交换

**知识总览**：

<img src="../images/image-202509211106.svg"  />

### Intro

#### 计算机网络发展初期面临的问题

<img src="../images/image-202509211113.png" style="zoom: 50%;" />

#### 人类历史上的通信网络

<img src="../images/image-202509211122.png" style="zoom: 50%;" />

### 电话网络（采用“电路交换”技术）

<img src="../images/image-202509211131.png" style="zoom: 60%;" />

#### 早期的电话交换机

<img src="../images/image-202509211134.webp" style="zoom: 60%;" />

<span style="font-weight:bold">电路<span style="color:#F66E00">交换</span>（Circuit <span style="color:#F66E00">Switching</span>）</span>：通过物理线路的连接，<span style="color:#DE1B4A">动态地分配传输线路资源</span>。

#### 电路交换的过程

1. 建立连接（尝试占用通信资源）
2. <span style="color:#FC7FB2"><span style="font-weight:bold">通信</span>（一直占用通信资源）</span>
3. 释放连接（归还通信资源）

<img src="../images/image-202509211147.webp" style="zoom: 60%;" />

> [!tip]
>
> 长途电话之所以更贵就是因为要占用<span style="color:#5A37C3; font-weight:bold">更多的通信资源</span>。

#### 如果计算机网络采用“电路交换”技术？

<img src="../images/image-202509211200.jpeg" style="zoom:60%;" />

显然，采用“电路交换”技术会存在问题。

#### “电路交换”的优缺点

<span style="font-weight:bold">电路交换的<span style="color:#DE1B4A">优点</span></span>：

通信前，从主叫端到被叫端建立一条<span style="color:#006A71; font-weight:bold">专用的物理通路</span>；在通信的全部时间内，两个用户<span style="color:#FF7E67; font-weight:bold">始终占用</span>端到端的<span style="color:#C14600; font-weight:bold">线路资源</span>。数据直送，<u>传输速率高</u>。（<span style="color:#E5890A">电路交换技术</span>更适用于<span style="color:#D27685">低频次</span>、<span style="color:#D27685">大量地</span>传输数据。）

<span style="font-weight:bold">电路交换的<span style="color:#4793AF">缺点</span></span>：

- <span style="color:#9E4784; font-weight:bold">建立/释放连接</span>，需要<span style="color:#9E4784; font-weight:bold">额外的时间开销</span>。（计算机之间数据往往是<span style="color:#EA2BA2">“突发式”传输</span>，即往往会<span style="color:#F05945">高频次</span>、<span style="color:#F05945">少量地</span>传输数据。）
- <span style="color:#F09027; font-weight:bold">线路</span>被通信双方<span style="color:#F09027; font-weight:bold">独占</span>，<span style="color:#6930C3; font-weight:bold">利用率低</span>。
- **线路**分配的**灵活性差**。
- 交换节点**不支持“差错控制”**。（无法发现传输过程中发生的数据错误。）

<img src="../images/image-202509211228.png" style="zoom:50%;" />

### 电报网络（采用“报文交换”技术）

<img src="../images/image-202509211254.png" style="zoom:60%;" />

<span style="color:#F31559; font-weight:bold">存储转发的思想</span>：把传送的数据单元<span style="color:#0EB29A">先存储进<span style="font-weight:bold">中间节点</span></span>，再根据目的地址<span style="color:#1572A1">转发至下一节点</span>。

#### 如果计算机网络采用“报文交换”技术？

<img src="../images/image-202509211402.svg" style="zoom: 67%;" />

#### “报文交换”的优缺点

<span style="font-weight:bold">报文交换的<span style="color:#6DA4AA">优点</span></span>：

- 通信前<span style="color:#C40B13"><span style="font-weight:bold">无需</span>建立连接</span>。
- 数据以“<span style="color:#1572A1">报文</span>”为单位被交换节点间“<span style="color:#1572A1">存储转发</span>”，通信<span style="color:#1572A1">线路可以灵活分配</span>。
- 在通信时间内，两个用户<span style="color:#F58634">无需独占</span>一整条物理线路。相比于电路交换，<span style="color:#F58634">线路利用率高</span>。
- 交换节点**支持“差错控制”**。（通过检验技术）

<span style="font-weight:bold">报文交换的<span style="color:#F47C7C">缺点</span></span>：

- 报文**不定长**，不便于<u>存储转发管理</u>。
- 长报文的<u>存储转发时间开销大</u>、<u>缓存开销大</u>。
- 长报文**容易出错**，重传代价高。

### "分组交换"技术

<img src="../images/image-202509211420.svg" style="zoom: 80%;" />

#### 现代计算机网络采用“分组交换”技术

<img src="../images/image-202509211425.png" style="zoom: 60%;" />

#### “分组交换”的优缺点

<span style="font-weight:bold">分组交换的<span style="color:#F47C7C">优点</span></span>：

- 通信前<span style="color:#FF895D"><span style="font-weight:bold">无需</span>建立连接</span>。
- 数据以“**分组**”为单位被交换节点间“**存储转发**”，通信<span style="color:#FF895D">线路可以灵活分配</span>。
- 在通信时间内，两个用户<span style="color:#FF895D">无需独占</span>一整条物理线路。相比于电路交换，<span style="color:#FF895D">线路利用率更高</span>。
- 交换节点<span style="color:#FF895D">支持“差错控制”</span>。（通过校验技术）

**相比于报文交换**，分组交换改进了如下问题：

- 分组**定长**，方便存储转发管理。
- 分组的<u>存储转发时间开销小</u>、<u>缓存开销小</u>。
- 分组**不易出错**，重传代价低。

<span style="font-weight:bold">分组交换的<span style="color:#AF47D2">优点</span></span>：

- 相比于报文交换，<u>控制信息占比增加</u>。
- 相比于电路交换，依旧存在**存储转发时延**。
- 报文被拆分为多个分组，传输过程中可能会出现**失序**、**丢失**等问题，增加<u>处理的复杂度</u>。

### “虚电路交换”技术

1. <span style="color:#4B56D2">建立连接 （虚拟电路）</span>
2. 通信（分组按序、按已建立好的既定线路发送，通信双方<span style="color:#A084E8">不独占线路</span>。）
3. <span style="color:#E85395">释放连接</span>

<img src="../images/image-202509211614.png" style="zoom: 60%;" />

## 电路交换、报文交换、分组交换（性能分析）

### 三种交换方式的性能对比

<img src="../images/image-202509211625.png" style="zoom: 67%;" />

### 电路交换性能分析

<img src="../images/image-202509211631.png" style="zoom:60%;" />

**假设**：

每一跳<span style="color:#02A8A8">传播时延</span>为 1ms，电路交换机建立、释放下一跳连接耗时为 1ms，接受方处理连接请求需要 2ms，数据传输速率为 0.5kb/ms，报文大小为 4kb。

> [!tip]
>
> 虽然连接释放的首个响应在时间上可<span style="color:#962D2D">紧随数据传输结束</span>，但在图中为便于区分，该信号线被<span style="color:#0046FF">略作分离显示</span>。

<img src="../images/image-202509211811.png" style="zoom: 70%;" />

### 报文交换性能分析

<img src="../images/image-202509211845.png" style="zoom:60%;" />

**假设**：

每一跳<span style="color:#FF7EE2">传播时延</span>为 1ms，数据传输速率为 0.5kb/ms，报文大小为 4kb，报文<span style="color:#FF6363">存储转发时延</span>为 2ms。

> [!tip]
>
> **中间节点**一定要接受完**整个报文**后，才能解析并转发。

上述例子中的传输时间为 31ms。

<img src="../images/image-202509211848.png" style="zoom: 67%;" />

### 分组交换性能分析

<img src="../images/image-202509211925.png" style="zoom: 67%;" />

**假设**：
每一跳<span style="color:#F95454">传播时延</span>为 1ms，数据传输速率为 0.5kb/ms，报文大小为 4kb，分组大小为 1kb，分组<span style="color:#0D92F4">存储转发时延</span>为 0.5ms。

> [!tip]
>
> 类似的，**中间节点**一定要接受完**整个分组**后，才能解析并转发。

<img src="../images/image-202509211928.png" style="zoom:67%;" />

---

**知识回顾**：

| 特性                     | 电路交换                       | 报文交换 | 分组交换                |
| ------------------------ | ------------------------------ | -------- | ----------------------- |
| 完成传输所需时间         | 😎最少（排除建立/释放连接耗时） | 😭最多    | 😊较少                   |
| 存储转发时延             | 😎无                            | 😭较高    | 😊较低                   |
| 通信前是否需要建立连接？ | 😭是                            | 😎否      | 😎否                     |
| 缓存开销                 | 😎无                            | 😭高      | 😊低                     |
| 是否支持差错控制？       | 😭不支持                        | 😎支持    | 😎支持                   |
| 报文数据有序到达？       | 😎是                            | 😎是      | 😭否                     |
| 是否需要额外的控制信息？ | 😎否                            | 😊是      | 😭是（控制信息占比最大） |
| 线路分配灵活性           | 😭不灵活                        | 😎灵活    | 😎非常灵活               |
| 线路利用率               | 😭低                            | 😎高      | 😎非常高                 |

## 计算机网络的分类

**知识总览**：

<img src="../images/image-202509221018.png" style="zoom: 60%;" />

### 按分布范围分类

#### 广域网（WAN, Wide Area Network）

- **范围**：几十至几千公里
- 跨省/跨国/跨洲

#### 城域网（MAN, Metropolitan Area Network）

- **范围**：几千米至几十千米
- 一个或几个相邻城市
- **通信技术**：常采用“<span style="color:#E85395">以太网技术</span>”，因此常并入局域网范畴探讨。

#### 局域网（LAN, Local Area Network）

- **范围**：几十米至几千米
- 学校/企业/工作单位/家庭
- **通信技术**：<span style="color:#E85395">以太网技术</span>

> [!tip]
>
> 如今局域网技术几乎均采用“<span style="color:#E85395">以太网技术</span>”实现，因此“<span style="color:#A084E8">以太网</span>”几乎成了“<span style="color:#EB2632">局域网</span>”的代名词。

#### 举例：广域网（WAN）、局域网（LAN）

<img src="../images/image-202509221109.png" style="zoom:60%;" />

> [!tip]
>
> **局域网**通过**路由器**接入**广域网**。

#### 个域网（PAN, Personal Area Network）

- **范围**：几十米以内
- 家庭/个人
- 通常是通过<u>无线技术</u>将个人设备连接起来的网络，因此也常称为<span style="color:#C9485B">无线个域网（WPAN, Wireless Personal Area Network）</span>。

#### 例子：个域网（PAN）

<img src="../images/image-202509221114.webp" style="zoom:80%;" />

### 按传播技术分类

- <span style="color:#F27370; font-weight:bold">广播式网络</span>：当一台计算机发送**数据分组**时，广播范围内所有计算机都会收到该分组，并通过<span style="color:#0B409C">检查分组的<span style="font-weight:bold">目的地址</span></span>决定是否接收该分组。
- <span style="color:#F27370; font-weight:bold">点对点网络</span>：数据只会从发送方“<span style="color:#E38817">点对点</span>”发到接收方，精准送达。（例如路由器的数据分组。）

### 按拓扑结构分类

<img src="../images/image-202509221231.png" style="zoom:60%;" />

<span style="color:#E42F45; font-weight:bold">总线形结构</span>：数据“<span style="color:#BD9354">广播式</span>”传输；存在“<span style="color:#E16A54">总线争用</span>”问题。（典型代表就是使用**集线器**连接的设备。）

<img src="../images/image-202509221245.png" style="zoom:60%;" />

<span style="color:#5893D4; font-weight:bold">环形结构</span>：数据“<span style="color:#719192">广播式</span>”传输；通过<span style="color:#FD8C04">“令牌”解决总线争用问题</span>，令牌顺环形依次传递，拿到令牌者可使用总线。（典型代表就是**令牌环网**，流行于 2000 年以前局域网技术。）

<img src="../images/image-202509221252.png" style="zoom:60%;" />

<span style="color:#FF7F3E; font-weight:bold">星形结构</span>：由**中央设备**实现数据的“<span style="color:#007580">点对点</span>”传输；<span style="color:#EA0599">不存在“总线争用”</span>问题。（典型代表就是**以太网交换机**连接的设备。）

<img src="../images/image-202509221300.png" style="zoom:60%;" />

<span style="color:#7579E7; font-weight:bold">网状结构</span>：数据通过各**中间节点**逐一存储转发；属于“<span style="color:#939B62">点到点</span>”传输。（典型代表就是众多**路由器**构建的**广域网**。）

### 按使用者分类

- **公用网**：向**公众开放**的网络；如办宽带、交手机话费即可使用的互联网。
- **专用网**：仅供某个组织**内部使用**的网络；如政府、军队、电力、银行的内部网络。

### 按传输介质分类

- **有线网络**：如网线、光纤等。
- **无线网络**：如 5G、Wi-Fi、卫星等。

---

**知识回顾**：

<img src="../images/image-202509221306.png" style="zoom: 60%;" />

## 计算机网络性能指标

**知识总览**：

<img src="../images/image-202509241112.svg"  />

### 速率

<span style="color:#F67280; font-weight:bold">信道（Channel）</span>：表示向某一方向传送<span style="color:#6F00FF">信息的通道</span>（信道 ≠ 通信线路）。一条通信线路在逻辑上往往对应一条<span style="color:#6F00FF">发送信道</span>和一条<span style="color:#6F00FF">接收信道</span>。

<img src="../images/image-202509241142.webp" style="zoom:60%;" />

<img src="../images/image-202509241149.webp" style="zoom:60%;" />

<span style="color:#8FA31E; font-weight:bold">速率（Speed）</span>：指连接到网络上的节点在信道上传输数据的速率，也称<span style="color:#EA2264">数据率</span>或<span style="color:#EA2264">比特率</span>、<span style="color:#EA2264; font-weight:bold"><u>数据传输速率</u></span>。

<span style="color:#3B38A0; font-weight:bold">速率单位</span>：bit/s，或 b/s，或 <span style="color:#EB5B00; font-weight:bold">bps</span>。

> [!tip]
>
> 有时也用 B/s（字节/秒），其中 1B = 8b（B = Byte，b = bit）。 

<img src="../images/image-202509241312.webp" style="zoom:60%;" />

> [!tip]
>
> 因为“计算机网络”沿用<span style="color:#B33791">国际单位制（SI）</span>，以 10 为底；而“计算机系统”早期<span style="color:#5409DA">基于二进制设计</span>，以 2 为底——导致相同字母（如 K、M、G、T）在不同场景下代表不同数值。

### 带宽

<span style="color:#9B177E; font-weight:bold">带宽（bandwidth）</span>：某信道所能传送的<span style="color:#FCB53B">最高数据率</span>。

在某个 ISP 宽带服务中，有：

<img src="../images/image-202509241335.webp" style="zoom:60%;" />

---

<img src="../images/image-202509260843.webp" alt="image-202509260843" style="zoom: 50%;" />

<img src="../images/image-202509260846.webp" style="zoom: 60%;" />

**结论**：节点间通信实际能达到的<u>最高速率</u>，<span style="color:#5E936C">由<span style="font-weight:bold">带宽</span>、<span style="font-weight:bold">节点性能</span>共同限制</span>。

<img src="../images/image-202509260908.webp" style="zoom: 60%;" />

### 带宽（另一含义）

在通信原理中，<span style="color:#3B38A0">带宽（bandwidth）</span>表示某信道允许通过的<u>信号频带范围</u>，单位：Hz。（读作“赫/赫兹”，可加上数量前缀 K、M、G、T。）

<img src="../images/image-202509260932.svg" style="zoom:67%;" />

<img src="../images/image-202509260938.webp" style="zoom: 50%;" />

### 吞吐量

<span style="color:#BA487F; font-weight:bold">吞吐量（Throughput）</span>：指<u>单位时间</u>内通过某个网络（或信道、接口）的<u>实际数据量</u>。吞吐量受带宽限制、受复杂的网络负载情况影响。

<img src="../images/image-202509260948.webp" style="zoom:50%;" />

---

**知识回顾**：

<img src="../images/image-202509260949.webp" style="zoom: 60%;" />

### 时延

<span style="color:#C5172E; font-weight:bold">时延（Delay）</span>：指数据（一个报文或分组，甚至比特）从网络（或链路）的<span style="color:#8F87F1">一端传送到另一端所需的时间</span>。有时也称为延迟或迟延。

<img src="../images/image-202509261144.webp" style="zoom: 67%;" />

<img src="../images/image-202509261223.webp" style="zoom: 67%;" />

> [!tip]
>
> 每经过一次<u>信道</u>，就会产生<u>发送时延以及传播时延</u>；每经过一次<u>路由器</u>，就会产生<u>处理时延以及排队时延</u>。

---

<img src="../images/image-202509261254.webp" style="zoom: 67%;" />
