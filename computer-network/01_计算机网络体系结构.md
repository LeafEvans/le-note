# 计算机网络体系结构

## 计算机网络的概念

**知识总览**：

<img src="../images/image-202509162043.svg"  />

### 计算机网络的定义

<span style="color:#6F00FF; font-weight:bold">计算机网络（Computer Networking）</span>是一个将众多<span style="color:#E45A92">分散的</span>、<span style="color:#E45A92">自治的</span>计算机系统，通过<span style="color:#3A6F43">通信设备</span>（路由器、5G 基站等）与<span style="color:#4FB7B3">线路</span>连接起来，由功能完善的<span style="color:#B45253">软件</span>实现<span style="color:#E45A92">资源共享</span>和<span style="color:#E45A92">信息传递</span>的系统。

<img src="../images/image-202509162051.webp" style="zoom: 50%;" />

### 计算机网络、互连网、互联网的区别

1. **计算机网络（Computer Networking）**
2. **互连网（internet）**
3. **互联网（或因特网，Internet）**

以下提到的“网”指的是哪个网？

1. “我们家宽带欠费，断**网**了”
2. “好兄弟，要不要一起去上**网**”
3. “想把手机投屏到电视上，需要将手机、电视连接到同一**网络**”
4. “银行工作人员需要登录银行**内网**才能给客户办理业务”

### 一个最简单的计算机网络

**计算机网络（简称网络）**：由若干<span style="color:#DC143C">结点（node，结点可以是计算机、集线器、交换机、路由器等）</span>和连接这些结点的<span style="color:#EF7722">链路（link，链路可以是有线链路、无线链路）</span>组成。

<img src="../images/image-202509162102.webp" style="zoom:50%;" />

因此可以使用**集线器（Hub）**：

<img src="../images/image-202509162104.webp" style="zoom:50%;" />

**集线器（Hub）**：

- 可以把**多个结点连接起来，组成一个计算机网络**。
- 普通民用领域已很少用集线器。
- “集线器“工作在<span style="color:#F7A5A5; font-weight:bold">物理层</span>。

> [!TIP]
>
> 集线器不能避免<u>数据冲突</u>；例如两台电脑同时发出数据，在集线器处发生数据冲突，最终导致数据传输失败，导致网络卡顿。

通常现在搭建一个计算机网络，不会使用集线器，而是采用**交换机（Switch）**：

<img src="../images/image-202509162113.webp" style="zoom:50%;" />

**交换机（Switch）**：

- 可以把**多个结点连接起来，组成一个计算机网络**。
- 家庭、公司、学校通常用交换机组建内部网络。
- “交换机”工作在<span style="color:#B87C4C; font-weight:bold">数据链路层</span>。

> [!TIP]
>
> <span style="color:#687FE5; font-weight:bold">交换机（Switch）</span>不会出现数据冲突的问题。

### 互连网（internet）

为了将多个计算机网络互通，使用到**路由器（Router）**：

<img src="../images/image-202509162124.svg" style="zoom:80%;" />

**路由器（Router）**：

- 可以**把两个或多个计算机网络互相连接起来**，形成规模。
- 更大的计算机网络，也可称为“互连网”。
- 路由器工作在<span style="color:#AF3E3E; font-weight:bold">网络层</span>。

### 例子：某银行的内部网络（互连网）

<img src="../images/image-202509162145.svg" style="zoom:80%;" />

### 例子：家庭内部网络

<img src="../images/image-202509162152.webp" style="zoom: 50%;" />

> [!TIP]
>
> 一般指的“路由器”和“家用路由器”有一些区别。
> $$
> 家用路由器 = 路由器 + 交换机 + 其他功能
> $$

**思考：怎样才能使用“电视投屏”的功能？**

手机和电视连接到<u>同一个网络</u>。

<img src="../images/image-202509171009.webp" style="zoom:50%;" />

### 互联网（或因特网，Internet）

**ISP（Internet Service Provider）**，即互联网服务提供商（如中国电信、中国移动、中国联通等）。

互联网（或因特网，Internet）是各大 ISP 和国际机构组建的，覆盖全球范围的互连网（internet）。

**互联网**必须使用 <span style="color:#E45A92">TCP/IP 协议</span>通信，**互连网**可使用<span style="color:#E45A92">任意协议</span>通信。

<img src="../images/image-202509171031.svg" style="zoom:80%;" />

### 如何理解“TCP/IP”协议？

<img src="../images/image-202509171034.webp" style="zoom:50%;" />

秦始皇统一六国后，车同轨、书同文、统一度量衡。

---

**知识回顾**：

<img src="../images/image-202509171039.webp" style="zoom: 67%;" />

## 计算机网络的组成、功能

**知识总览**：

<img src="../images/image-202509171043.png" style="zoom:80%;" />

### 计算机网络的组成：从组成部分来看

<img src="../images/image-202509171046.png" style="zoom:67%;" />

#### 硬件、软件、协议

<img src="../images/image-202509182153.png" style="zoom:67%;" />

> [!TIP]
>
> 除了上述这些硬件之外，每个网络<span style="color:#FFA09B; font-weight:bold">内部</span>可能使用：集线器、交换机、路由器、调制解调器、无线基站、网线、光纤等各种设备或线路。

#### 拓展：网络适配器

<span style="color:#A19AD3; font-weight:bold">有线网络适配器</span>：

<img src="../images/image-202509182216.jpg" style="zoom: 25%;" />

<span style="color:#A19AD3; font-weight:bold">无线网络适配器</span>：

<img src="../images/image-202509182228.webp" style="zoom: 67%;" />

### 计算机网络的组成：从工作方式看

<img src="../images/image-202509182244.png" style="zoom: 60%;" />

#### 计算机网络的组成

<img src="../images/image-202509182255.webp" style="zoom: 60%;" />

> [!tip]
>
> **交换服务**（Switching Service）就是<span style="color:#6F00FF">动态地</span>去选择数据在网络中传输的路径，以保证各条路径都不会<span style="color:#3A6F43">负担太重</span>。

### 计算机网络的组成：从逻辑功能看

<img src="../images/image-202509190829.webp" style="zoom: 60%;" />

#### 资源子网、通信子网

<img src="../images/image-202509190844.webp" style="zoom: 60%;" />

### 计算机网络的功能

<img src="../images/image-202509190846.png" style="zoom: 60%;" />

#### 计算机网络的功能：数据通信

<img src="../images/image-202509190852.webp" style="zoom:60%;" />

 #### 计算机网络的功能：资源共享

<img src="../images/image-202509190901.png" style="zoom:80%;" />

#### 计算机网络的功能：分布式处理

<img src="../images/image-202509190944.webp" style="zoom: 65%;" />

#### 计算机网络的功能：提高可靠性

<img src="../images/image-202509190954.png" style="zoom:65%;" />

网络中的<span style="color:#F66E00; font-weight:bold">各台计算机</span>互为<span style="color:#191BA9; font-weight:bold">替代机</span>。

#### 计算机网络的功能：负载均衡

<img src="../images/image-202509191156.png" style="zoom:65%;" />

上述例子中的服务器 A 专门负责对战匹配。

---

**知识回顾**：

<img src="../images/image-202509191159.png" style="zoom:80%;" />

## 电报交换、报文交换、分组交换

**知识总览**：

<img src="../images/image-202509211106.svg"  />

### Intro

#### 计算机网络发展初期面临的问题

<img src="../images/image-202509211113.png" style="zoom: 50%;" />

#### 人类历史上的通信网络

<img src="../images/image-202509211122.png" style="zoom: 50%;" />

### 电话网络（采用“电路交换”技术）

<img src="../images/image-202509211131.png" style="zoom: 60%;" />

#### 早期的电话交换机

<img src="../images/image-202509211134.webp" style="zoom: 60%;" />

<span style="font-weight:bold">电路<span style="color:#F66E00">交换</span>（Circuit <span style="color:#F66E00">Switching</span>）</span>：通过物理线路的连接，<span style="color:#DE1B4A">动态地分配传输线路资源</span>。

#### 电路交换的过程

1. 建立连接（尝试占用通信资源）
2. <span style="color:#FC7FB2"><span style="font-weight:bold">通信</span>（一直占用通信资源）</span>
3. 释放连接（归还通信资源）

<img src="../images/image-202509211147.webp" style="zoom: 60%;" />

> [!tip]
>
> 长途电话之所以更贵就是因为要占用<span style="color:#5A37C3; font-weight:bold">更多的通信资源</span>。

#### 如果计算机网络采用“电路交换”技术？

<img src="../images/image-202509211200.jpeg" style="zoom:60%;" />

显然，采用“电路交换”技术会存在问题。

#### “电路交换”的优缺点

<span style="font-weight:bold">电路交换的<span style="color:#DE1B4A">优点</span></span>：

通信前，从主叫端到被叫端建立一条<span style="color:#006A71; font-weight:bold">专用的物理通路</span>；在通信的全部时间内，两个用户<span style="color:#FF7E67; font-weight:bold">始终占用</span>端到端的<span style="color:#C14600; font-weight:bold">线路资源</span>。数据直送，<u>传输速率高</u>。（<span style="color:#E5890A">电路交换技术</span>更适用于<span style="color:#D27685">低频次</span>、<span style="color:#D27685">大量地</span>传输数据。）

<span style="font-weight:bold">电路交换的<span style="color:#4793AF">缺点</span></span>：

- <span style="color:#9E4784; font-weight:bold">建立/释放连接</span>，需要<span style="color:#9E4784; font-weight:bold">额外的时间开销</span>。（计算机之间数据往往是<span style="color:#EA2BA2">“突发式”传输</span>，即往往会<span style="color:#F05945">高频次</span>、<span style="color:#F05945">少量地</span>传输数据。）
- <span style="color:#F09027; font-weight:bold">线路</span>被通信双方<span style="color:#F09027; font-weight:bold">独占</span>，<span style="color:#6930C3; font-weight:bold">利用率低</span>。
- **线路**分配的**灵活性差**。
- 交换节点**不支持“差错控制”**。（无法发现传输过程中发生的数据错误）

<img src="../images/image-202509211228.png" style="zoom:50%;" />

### 电报网络（采用“报文交换”技术）

<img src="../images/image-202509211254.png" style="zoom:60%;" />

<span style="color:#F31559; font-weight:bold">存储转发的思想</span>：把传送的数据单元<span style="color:#0EB29A">先存储进<span style="font-weight:bold">中间节点</span></span>，再根据目的地址<span style="color:#1572A1">转发至下一节点</span>。

#### 如果计算机网络采用“报文交换”技术？

<img src="../images/image-202509211402.svg" style="zoom: 67%;" />

#### “报文交换”的优缺点

<span style="font-weight:bold">报文交换的<span style="color:#6DA4AA">优点</span></span>：

- 通信前<span style="color:#C40B13"><span style="font-weight:bold">无需</span>建立连接</span>。
- 数据以“<span style="color:#1572A1">报文</span>”为单位被交换节点间“<span style="color:#1572A1">存储转发</span>”，通信<span style="color:#1572A1">线路可以灵活分配</span>。
- 在通信时间内，两个用户<span style="color:#F58634">无需独占</span>一整条物理线路。相比于电路交换，<span style="color:#F58634">线路利用率高</span>。
- 交换节点**支持“差错控制”**。（通过检验技术）

<span style="font-weight:bold">报文交换的<span style="color:#F47C7C">缺点</span></span>：

- 报文**不定长**，不便于<u>存储转发管理</u>。
- 长报文的<u>存储转发时间开销大</u>、<u>缓存开销大</u>。
- 长报文**容易出错**，重传代价高。

### "分组交换"技术

<img src="../images/image-202509211420.svg" style="zoom: 80%;" />

#### 现代计算机网络采用“分组交换”技术

<img src="../images/image-202509211425.png" style="zoom: 60%;" />

#### “分组交换”的优缺点

<span style="font-weight:bold">分组交换的<span style="color:#F47C7C">优点</span></span>：

- 通信前<span style="color:#FF895D"><span style="font-weight:bold">无需</span>建立连接</span>。
- 数据以“**分组**”为单位被交换节点间“**存储转发**”，通信<span style="color:#FF895D">线路可以灵活分配</span>。
- 在通信时间内，两个用户<span style="color:#FF895D">无需独占</span>一整条物理线路。相比于电路交换，<span style="color:#FF895D">线路利用率更高</span>。
- 交换节点<span style="color:#FF895D">支持“差错控制”</span>。（通过校验技术）

**相比于报文交换**，分组交换改进了如下问题：

- 分组**定长**，方便存储转发管理。
- 分组的<u>存储转发时间开销小</u>、<u>缓存开销小</u>。
- 分组**不易出错**，重传代价低。

<span style="font-weight:bold">分组交换的<span style="color:#AF47D2">缺点</span></span>：

- 相比于报文交换，<u>控制信息占比增加</u>。
- 相比于电路交换，依旧存在**存储转发时延**。
- 报文被拆分为多个分组，传输过程中可能会出现**失序**、**丢失**等问题，增加<u>处理的复杂度</u>。

### “虚电路交换”技术

1. <span style="color:#4B56D2">建立连接 （虚拟电路）</span>
2. 通信（分组按序、按已建立好的既定线路发送，通信双方<span style="color:#A084E8">不独占线路</span>）
3. <span style="color:#E85395">释放连接</span>

<img src="../images/image-202509211614.png" style="zoom: 60%;" />

## 电路交换、报文交换、分组交换（性能分析）

### 三种交换方式的性能对比

<img src="../images/image-202509211625.png" style="zoom: 67%;" />

### 电路交换性能分析

<img src="../images/image-202509211631.png" style="zoom:60%;" />

**假设**：

每一跳<span style="color:#02A8A8">传播时延</span>为 1ms，电路交换机建立、释放下一跳连接耗时为 1ms，接受方处理连接请求需要 2ms，数据传输速率为 0.5kb/ms，报文大小为 4kb。

> [!tip]
>
> 虽然连接释放的首个响应在时间上可<span style="color:#962D2D">紧随数据传输结束</span>，但在图中为便于区分，该信号线被<span style="color:#0046FF">略作分离显示</span>。

<img src="../images/image-202509211811.png" style="zoom: 70%;" />

### 报文交换性能分析

<img src="../images/image-202509211845.png" style="zoom:60%;" />

**假设**：

每一跳<span style="color:#FF7EE2">传播时延</span>为 1ms，数据传输速率为 0.5kb/ms，报文大小为 4kb，报文<span style="color:#FF6363">存储转发时延</span>为 2ms。

> [!tip]
>
> **中间节点**一定要接受完**整个报文**后，才能解析并转发。

上述例子中的传输时间为 31ms。

<img src="../images/image-202509211848.png" style="zoom: 67%;" />

### 分组交换性能分析

<img src="../images/image-202509211925.png" style="zoom: 67%;" />

**假设**：
每一跳<span style="color:#F95454">传播时延</span>为 1ms，数据传输速率为 0.5kb/ms，报文大小为 4kb， 分组大小为 1kb，分组<span style="color:#0D92F4">存储转发时延</span>为 0.5ms。

> [!tip]
>
> 类似的，**中间节点**一定要接受完**整个分组**后，才能解析并转发。

<img src="../images/image-202509211928.png" style="zoom:67%;" />

---

**知识回顾**：

| 特性                     | 电路交换                       | 报文交换 | 分组交换                |
| ------------------------ | ------------------------------ | -------- | ----------------------- |
| 完成传输所需时间         | 😎最少（排除建立/释放连接耗时） | 😭最多    | 😊较少                   |
| 存储转发时延             | 😎无                            | 😭较高    | 😊较低                   |
| 通信前是否需要建立连接？ | 😭是                            | 😎否      | 😎否                     |
| 缓存开销                 | 😎无                            | 😭高      | 😊低                     |
| 是否支持差错控制？       | 😭不支持                        | 😎支持    | 😎支持                   |
| 报文数据有序到达？       | 😎是                            | 😎是      | 😭否                     |
| 是否需要额外的控制信息？ | 😎否                            | 😊是      | 😭是（控制信息占比最大） |
| 线路分配灵活性           | 😭不灵活                        | 😎灵活    | 😎非常灵活               |
| 线路利用率               | 😭低                            | 😎高      | 😎非常高                 |

## 计算机网络的分类

**知识总览**：

<img src="../images/image-202509221018.png" style="zoom: 60%;" />

### 按分布范围分类

#### 广域网（WAN, Wide Area Network）

- **范围**：几十至几千公里
- 跨省/跨国/跨洲

#### 城域网（MAN, Metropolitan Area Network）

- **范围**：几千米至几十千米
- 一个或几个相邻城市
- **通信技术**：常采用“<span style="color:#E85395">以太网技术</span>”，因此常并入局域网范畴探讨。

#### 局域网（LAN, Local Area Network）

- **范围**：几十米至几千米
- 学校/企业/工作单位/家庭
- **通信技术**：<span style="color:#E85395">以太网技术</span>

> [!tip]
>
> 如今局域网技术几乎均采用“<span style="color:#E85395">以太网技术</span>”实现，因此“<span style="color:#A084E8">以太网</span>”几乎成了“<span style="color:#EB2632">局域网</span>”的代名词。

#### 举例：广域网（WAN）、局域网（LAN）

<img src="../images/image-202509221109.png" style="zoom:60%;" />

> [!tip]
>
> **局域网**通过**路由器**接入**广域网**。

#### 个域网（PAN, Personal Area Network）

- **范围**：几十米以内
- 家庭/个人
- 通常是通过<u>无线技术</u>将个人设备连接起来的网络，因此也常称为<span style="color:#C9485B">无线个域网（WPAN, Wireless Personal Area Network）</span>。

#### 例子：个域网（PAN）

<img src="../images/image-202509221114.webp" style="zoom:80%;" />

### 按传播技术分类

- <span style="color:#F27370; font-weight:bold">广播式网络</span>：当一台计算机发送**数据分组**时，广播范围内所有计算机都会收到该分组，并通过<span style="color:#0B409C">检查分组的<span style="font-weight:bold">目的地址</span></span>决定是否接收该分组。
- <span style="color:#F27370; font-weight:bold">点对点网络</span>：数据只会从发送方“<span style="color:#E38817">点对点</span>”发到接收方，精准送达。（例如路由器的数据分组。）

### 按拓扑结构分类

<img src="../images/image-202509221231.png" style="zoom:60%;" />

<span style="color:#E42F45; font-weight:bold">总线形结构</span>：数据“<span style="color:#BD9354">广播式</span>”传输；存在“<span style="color:#E16A54">总线争用</span>”问题。（典型代表就是使用**集线器**连接的设备。）

<img src="../images/image-202509221245.png" style="zoom:60%;" />

<span style="color:#5893D4; font-weight:bold">环形结构</span>：数据“<span style="color:#719192">广播式</span>”传输；通过<span style="color:#FD8C04">“令牌”解决总线争用问题</span>，令牌顺环形依次传递，拿到令牌者可使用总线。（典型代表就是**令牌环网**，流行于 2000 年以前局域网技术。）

<img src="../images/image-202509221252.png" style="zoom:60%;" />

<span style="color:#FF7F3E; font-weight:bold">星形结构</span>：由**中央设备**实现数据的“<span style="color:#007580">点对点</span>”传输；<span style="color:#EA0599">不存在“总线争用”</span>问题。（典型代表就是**以太网交换机**连接的设备。）

<img src="../images/image-202509221300.png" style="zoom:60%;" />

<span style="color:#7579E7; font-weight:bold">网状结构</span>：数据通过各**中间节点**逐一存储转发；属于“<span style="color:#939B62">点到点</span>”传输。（典型代表就是众多**路由器**构建的**广域网**。）

### 按使用者分类

- **公用网**：向**公众开放**的网络；如办宽带、交手机话费即可使用的互联网。
- **专用网**：仅供某个组织**内部使用**的网络；如政府、军队、电力、银行的内部网络。

### 按传输介质分类

- **有线网络**：如网线、光纤等。
- **无线网络**：如 5G、Wi-Fi、卫星等。

---

**知识回顾**：

<img src="../images/image-202509221306.png" style="zoom: 60%;" />

## 计算机网络性能指标

**知识总览**：

<img src="../images/image-202509241112.svg"  />

### 速率

<span style="color:#F67280; font-weight:bold">信道（Channel）</span>：表示向某一方向传送<span style="color:#6F00FF">信息的通道</span>（信道 ≠ 通信线路）。一条通信线路在逻辑上往往对应一条<span style="color:#6F00FF">发送信道</span>和一条<span style="color:#6F00FF">接收信道</span>。

<img src="../images/image-202509241142.webp" style="zoom:60%;" />

<img src="../images/image-202509241149.webp" style="zoom:60%;" />

<span style="color:#8FA31E; font-weight:bold">速率（Speed）</span>：指连接到网络上的节点在信道上传输数据的速率，也称<span style="color:#EA2264">数据率</span>或<span style="color:#EA2264">比特率</span>、<span style="color:#EA2264; font-weight:bold"><u>数据传输速率</u></span>。

<span style="color:#3B38A0; font-weight:bold">速率单位</span>：bit/s，或 b/s，或 <span style="color:#EB5B00; font-weight:bold">bps</span>。

> [!tip]
>
> 有时也用 B/s（字节/秒），其中 1B = 8b（B = Byte，b = bit）。 

<img src="../images/image-202509241312.webp" style="zoom:60%;" />

> [!tip]
>
> 因为“计算机网络”沿用<span style="color:#B33791">国际单位制（SI）</span>，以 10 为底；而“计算机系统”早期<span style="color:#5409DA">基于二进制设计</span>，以 2 为底——导致相同字母（如 K、M、G、T）在不同场景下代表不同数值。

### 带宽

<span style="color:#9B177E; font-weight:bold">带宽（bandwidth）</span>：某信道所能传送的<span style="color:#FCB53B">最高数据率</span>。

在某个 ISP 宽带服务中，有：

<img src="../images/image-202509241335.webp" style="zoom:60%;" />

---

<img src="../images/image-202509260843.webp" alt="image-202509260843" style="zoom: 50%;" />

<img src="../images/image-202509260846.webp" style="zoom: 60%;" />

**结论**：节点间通信实际能达到的<u>最高速率</u>，<span style="color:#5E936C">由<span style="font-weight:bold">带宽</span>、<span style="font-weight:bold">节点性能</span>共同限制</span>。

<img src="../images/image-202509260908.webp" style="zoom: 60%;" />

### 带宽（另一含义）

在通信原理中，<span style="color:#3B38A0">带宽（bandwidth）</span>表示某信道允许通过的<u>信号频带范围</u>，单位：Hz。（读作“赫/赫兹”，可加上数量前缀 K、M、G、T。）

<img src="../images/image-202509260932.svg" style="zoom:67%;" />

<img src="../images/image-202509260938.webp" style="zoom: 50%;" />

### 吞吐量

<span style="color:#BA487F; font-weight:bold">吞吐量（Throughput）</span>：指<u>单位时间</u>内通过某个网络（或信道、接口）的<u>实际数据量</u>。吞吐量受带宽限制、受复杂的网络负载情况影响。

<img src="../images/image-202509260948.webp" style="zoom:50%;" />

---

**知识回顾**：

<img src="../images/image-202509260949.webp" style="zoom: 60%;" />

### 时延

<span style="color:#C5172E; font-weight:bold">时延（Delay）</span>：指数据（一个报文或分组，甚至比特）从网络（或链路）的<span style="color:#8F87F1">一端传送到另一端所需的时间</span>。有时也称为延迟或迟延。

<img src="../images/image-202509261144.webp" style="zoom: 67%;" />

<img src="../images/image-202509261223.webp" style="zoom: 67%;" />

> [!tip]
>
> 每经过一次<u>信道</u>，就会产生<u>发送时延以及传播时延</u>；每经过一次<u>路由器</u>，就会产生<u>处理时延以及排队时延</u>。

---

<img src="../images/image-202509261254.webp" style="zoom: 67%;" />

<img src="../images/image-202509271143.svg" />

<img src="../images/image-202509271144.webp" style="zoom: 67%;" />

### 时延带宽积

**时延带宽积的含义**：一条链路中，<span style="color:#3674B5; font-weight:bold">已</span>从发送端<span style="color:#3674B5; font-weight:bold">发出但尚未到达</span>接收端的<span style="color:#3674B5; font-weight:bold"><u>最大</u>比特数</span>。
$$
时延带宽积 = 传播时延 \times 带宽
$$
<img src="../images/image-202509271202.svg" style="zoom:80%;" />

---

<img src="../images/image-202509271207.webp" style="zoom: 60%;" />

<img src="../images/image-202509271223.webp" style="zoom:60%;" />
$$
传输文件总时间 = 0.01ms + 0.08ms + 0.01ms + (0.08ms \times 1000) = 80.10ms
$$

### 往返时延（RTT）

<span style="color:#B82132; font-weight:bold">往返时延 RTT（Round-Trip Time）</span>：表示从发送方<span style="color:#DA498D">发送完数据</span>，至到发送方收到来自接收方的**确认**总共经历的时间。

<img src="../images/image-202509271256.webp" style="zoom:60%;" />

<img src="../images/image-202509271254.webp" style="zoom:50%;" />

### 信道利用率

**信道利用率**：某个信道有百分之多少的时间是有数据通过的。
$$
信道利用率 = \frac{有数据通过的时间}{有数据通过的时间 + 没有数据通过的时间}
$$

- 信道利用率不能太低，浪费资源。（有些高速路段车辆很少，车道利用率极低，浪费资源。）
- 信道利用率也不能太高，容易导致网络拥塞。（节假日高速路，车道利用率极高，堵车。）

---

<img src="../images/image-202509271301.webp" style="zoom: 60%;" />

---

**知识回顾**：

<img src="../images/image-202509271306.webp" style="zoom: 67%;" />

## 计算机网络分层结构

**知识总览**：

<img src="../images/image-202509271905.svg"  />

### “分层”的设计思想

**分层设计的思想**：将庞大而复杂的问题，转化为若干较小的局部问题。

<img src="../images/image-202509271907.webp"  />

快递网络是一个非常复杂的系统。<span style="color:#074799; font-weight:bold">快递网络需要完成很多功能：</span>

- 货物打包
- 取件、派件
- 冷链存储
- 包裹“路由”（选择合适的包裹运输路线）
- 运输包裹

### 快递网络的四层体系结构

<img src="../images/image-202509271916.webp"  />

将复杂的快递网络在逻辑上<span style="color:#AB4459; font-weight:bold">划分为多个层次</span>，并将各种“功能”安排在<span style="color:#493D9E">合适的层次</span>中。

<span style="color:#493D9E; font-weight:bold">不同类型</span>的节点，实现的<span style="color:#493D9E; font-weight:bold">功能层次可能不一样</span>。

### 计算机网络要实现的功能

<img src="../images/image-202509271923.webp" style="zoom:80%;" />

计算机网络是一个非常复杂的系统，要完成诸多功能，如：

- **差错控制**：确保数据在传输过程中不出错。
- **流量控制**：发送端的发送速率必须使接收端来得及接收，不要太快。
- **分段和重装**：发送端将要发送的数据块划分为更小的单位，并在接收端将其还原。
- **复用和分用**：发送端几个高层会话复用一条低层的连接，在接收端再进行分用。
- **连接建立和释放**：交换数据前先建立一条逻辑连接，数据传送结束后释放连接。

### 计算机网络的分层结构

将复杂的计算机网络在逻辑上<span style="color:#4A628A; font-weight:bold">划分为多个层次</span>，并将各种“功能”<span style="color:#72BF78; font-weight:bold">安排在合适的层次</span>中。

<span style="color:#493D9E; font-weight:bold">不同类型</span>的节点，实现的<span style="color:#493D9E; font-weight:bold">功能层次可能不一样</span>。

<img src="../images/image-202509271939.webp" style="zoom:80%;" />

### 快递网络的五层体系结构

<img src="../images/image-202509271941.webp" style="zoom:80%;" />

<span style="color:#A04747; font-weight:bold">分层结构的设计并不唯一</span>，可以根据实际需求增加或减少层次。

<span style="color:#C7253E">同一个功能</span>可以在多个层次中重复出现。

### 三种常见的计算机网络体系结构

![image-202509271956](../images/image-202509271956.png)

### 网络体系结构的概念

<span style="color:#AB4459; font-weight:bold">网络的体系结构</span>（Network Architecture）是计算机网络的各层及其协议（实现各个功能）的<span style="color:#AB4459">集合</span>，就是这个计算机网络及其构件所应完成的<span style="color:#AB4459">功能的精确定义（不涉及实现）</span>。

<span style="color:#EB5B00">实现</span>（implementation）是遵循这种体系结构的前提下，用何种硬件或软件完成这些功能的问题。

体系结构是**抽象**的，而实现则是**具体**的。

### 各层之间的关系

<img src="../images/image-202509272113.svg" style="zoom:80%;" />

- <span style="color:#973131; font-weight:bold">实体</span>（entity）：在计算机网络的分层结构中，第 n 层中的活动元素（软件 + 硬件）通常称为第 n 层实体。不同机器上的同一层称为<span style="color:#447D9B; font-style:italic; font-weight:bold">对等层</span>，同一层的实体称为<span style="color:#447D9B; font-style:italic; font-weight:bold">对等实体</span>。
- <span style="color:#973131; font-weight:bold">协议</span>：即网络协议（Network Protocol），是控制对等实体之间进行通信的规则的集合，是<span style="color:#447D9B"><u>水平的</u></span>。

<img src="../images/image-202509272332.svg" style="zoom:80%;" />

- <span style="color:#973131; font-weight:bold">接口</span>：即同一节点内<span style="color:#725CAD; font-style:italic; font-weight:bold">相邻两层的实体</span>交换信息的逻辑接口，又称为<span style="color:#725CAD; font-weight:bold">服务访问点</span>（Service Access Point, SAP）。
- <span style="color:#973131; font-weight:bold">服务</span>：服务是指<span style="color:#725CAD; font-style:italic; font-weight:bold">下层为紧邻的上层</span>提供的功能调用，它是<span style="color:#725CAD"><u>垂直的</u></span>。

### 数据传输过程（水平）

<img src="../images/image-202509280000.webp" style="zoom: 60%;" />

<img src="../images/image-202509281009.webp" style="zoom: 50%;" />

<img src="../images/image-202509281008.svg"  />

**为什么要分层？为什么要制定协议？**

计算机网络功能复杂 → 采用分层结构，将诸多功能合理地划分在不同层次 → 对等层之间制定协议，以实现功能。

### 数据的传输过程（垂直视角）

<img src="../images/image-202509281022.webp" style="zoom:80%;" />

<img src="../images/image-202509281036.webp" style="zoom:80%;" />

### PDU、SDU、PCI 的概念

<img src="../images/image-202509281053.webp" style="zoom: 67%;" />

- **协议数据单元（Protocol Data Unit, PDU）**：对等层次之间传送的数据单位。第 n 层的 PDU 记为 n-PDU。
- **服务数据单元（Service Data Unit, SDU）**：为完成上一层实体所要求的功能而传送的数据。第 n 层的 SDU 记为 n-SDU。
- **协议控制信息（Protocol Control Information, PCI）**：控制协议操作的信息。第 n 层的 PCI 记为 n-PCI。
- 三者的关系为 **n-SDU + n-PCI = n-PDU = (n-1)-SDU**。

### 协议的三要素

<span style="color:#08CB00; font-weight:bold">协议</span>：即网络协议（Network Protocol），是控制对等实体之间进行通信的规则的集合，<u><span style="color:#C5172E">是水平的</span></u>。

协议由<span style="color:#FF0B55">语法</span>、<span style="color:#FF0B55">语义</span>和<span style="color:#FF0B55">同步</span>三部分组成（协议的三要素）：

1. <span style="color:#FF0B55">语法（Syntax）</span>，数据与控制信息的格式。例如，协议控制信息（首部）部分占几个字节、每个字节是什么含义；协议的数据部分最多有多少字节。
2. <span style="color:#FF0B55">语义（Semantics）</span>，即需要发出何种控制信息、完成何种动作及做出何种应答。例如，协议中需要明确规定：发送方发完数据后，接收方是否需要“应答”，以及应答的种类有哪些（如传输成功、传输失败）。
3.  <span style="color:#FF0B55">同步</span>或<span style="color:#FF0B55">时序</span>（Synchronization 或 Timing），执行各种操作的条件、时序关系等，即事件实现顺序的详细说明。例如，发送方发完数据后，接收方需要立即应答。如果发送方在 10 秒内未收到“传输成功”应答，则发送方会再次发送数据。

---

**知识回顾**：

<img src="../images/image-202509281117.webp" style="zoom: 60%;" />

## OSI 参考模型

**知识总览**：

<img src="../images/image-202510141105.svg"  />

### 术语声明

<img src="../images/image-202510141110.webp" style="zoom: 50%;" />

### 常见网络设备的功能层次

<img src="../images/image-202510141129.webp" style="zoom: 50%;" />

<img src="../images/image-202510141131.webp" style="zoom:50%;" />

### 物理层

<img src="../images/image-202510141136.webp" style="zoom: 50%;" />

<span style="color:#FF3F7F; font-weight:bold">物理层任务</span>：实现<u>相邻节点</u>之间<span style="color:#BF092F; font-weight:bold">比特（0 或 1）的传输</span>。

1. 需要定义电路接口参数（例如形状、尺寸、引脚数等）。
2. 需要定义传输信号的含义、电气特征（例如 5V 表示 1，1V 表示 0；每比特电信号持续时间 0.1ms）。

<img src="../images/image-202510141141.webp" style="zoom: 67%;" />

> [!tip]
>
> 在数据传输过程中，信号可能受到外界噪声干扰而发生失真。 
>
> 例如，一个原本表示“1”的高电平信号，可能因环境噪声影响而被误判为低电平，导致接收端错误地将其识别为“0”。 
>
> 因此，以比特为单位的数据传输存在出错的可能性。

### 链路层

<span style="color:#F5AD18; font-weight:bold">链路层任务</span>：确保<u>相邻节点</u>之间的链路<span style="color:#3B9797; font-weight:bold">逻辑上无差错</span>。

1. **差错控制**：检查 + 纠错；或检查 + 丢弃 + 重传。
2. **流量控制**：协调两个节点的速率。

<img src="../images/image-202510141242.webp" style="zoom:67%;" />

> [!tip]
>
> 发送速率过快可能导致丢帧。例如，当节点 A 发送 10 帧，而节点 B 的处理能力仅为 5 帧时，B 会通过流量控制协议要求 A 降低发送速度。

### 网络层

<span style="color:#1055C9; font-weight:bold">网络层任务</span>：<span style="color:#41A67E; font-weight:bold">把“分组”从源节点转发到目的节点。</span>

1. **路由选择**：构造并维护路由表，决定分组到达目的节点的最佳路径。
2. **分组转发**：将“分组”从合适的端口转发出去。
3. **拥塞控制**：发现网络拥塞，并采取措施缓解拥塞。
4. **网际互联**：实现异构网络互联。
5. 其他功能（<u>以“分组”为单位</u>）：*差错控制*、*流量控制*、*连接建立与是否*（<u>确保分组有序，不重复到达</u>）、可*靠传输管理*（<u>接收方需返回分组确认信息</u>）。

<img src="../images/image-202510141256.webp" style="zoom:67%;" />

### 传输层

<span style="color:#842A3B; font-weight:bold">传输层任务</span>：实现<u>端到端</u>通信（即实现<u>进程到进程</u>的通信，“端”指“**端口**”）。

1. **复用和分用**：发送端几个高层实体复用一条低层的连接，在接收端再进行分用。
2. 其他功能（<u>以“报文段”为单位</u>）：*差错控制*、*流量控制*、*连接的建立与释放*（确保报文段有序、不重复到达）、*可靠传输管理*（接收方需返回报文段确认消息）。

<img src="../images/image-202510141330.webp" style="zoom:80%;" />

### 5~7 层

- <span style="color:#5D866C; font-weight:bold">会话层任务</span>：管理进程间会话。

  **主要功能**：<u>会话管理</u>（采用节点检查机制，当通信失效时，从检查点继续恢复通信）。

- <span style="color:#696FC7; font-weight:bold">表示层任务</span>：解决不同主机上信息表示不一致的问题。

  **主要功能**：<u>数据格式转换</u>（如编码转换、压缩/解压、加密/解密）。

- <span style="color:#ED3F27; font-weight:bold">应用层任务</span>：实现特定的网络应用。

  功能繁多，根据应用需求设计。

<img src="../images/image-202510141342.webp" style="zoom:67%;" />

### 各层数据传输单位

<img src="../images/image-202510141527.webp" style="zoom:80%;" />

---

**知识回顾**：

<img src="../images/image-202510141532.webp" style="zoom:67%;" />

## TCP/IP 模型

**知识总览**：

<img src="../images/image-202510141606.svg"  />

### 回顾

#### OSI 参考模型 5~7 层

并不是所有网络应用都需要<u>数据格式转换</u>、<u>会话管理功能</u>。

<img src="../images/image-202510141621.webp" style="zoom:67%;" />

**TCP/IP 的理念**：如果某些应用需要<u>数据格式转换</u>、<u>会话管理</u>功能，就交个应用层的特定协议来实现。

<span style="color:#5D866C; font-weight:bold">应用层任务</span>：实现特定的网络应用（功能复杂且多样）。

#### OSI 参考模型 1~2 层

网络硬件种类繁多、日新月异，不应该有过多限制。

<img src="../images/image-202510141641.webp" style="zoom: 67%;" />

<span style="color:#6E8CFB; font-weight:bold">网络接口层任务</span>：实现相邻节点间数据传输（为网络层传输“分组”），但<u>*具体如何传输不作规定*</u>。

这使得 TCP/IP 网络体系结构具有更强的灵活性、适应性。

### OSI 参考模型 vs. TCP/IP 模型

<img src="../images/image-202510141648.webp" style="zoom:80%;" />

在 OSI 参考模型中，局部正确性并不足以保证全局正确性；但若全局正确性得以保证，则局部正确性自然成立。因此，传输层只需以报文段为单位，确保所传输的数据无差错、有序且可靠，即可满足整体的正确性要求。

### 网络层

<span style="color:#344F1F; font-weight:bold">TCP/IP 网络层功能</span>：<span style="color:#6F00FF">路由选择</span>、<span style="color:#6F00FF">分组转发</span>、拥塞控制、网际互联。（*去除了差错管理、流量控制、连接管理、可靠传输管理*）

TCP/IP 网络层只保证“<u>尽最大能力交付</u>”，数据传输是不可靠的。

<img src="../images/image-202510141713.webp" style="zoom: 67%;" />

### 传输层

<span style="color:#E45A92; font-weight:bold">TCP/IP 传输层功能</span>：**复用和分用**、差错控制、流量控制、连接建立与释放、可靠传输管理。

在 TCP/IP 模型中，由传输层负责保证数据传输的正确性、可靠性。

<img src="../images/image-202510141724.webp" style="zoom:80%;" />

在 OSI 模型中，由于网络层还需承担差错控制、流量控制等功能，导致网络核心设备（如路由器）功能复杂、负载高、成本昂贵。

在 TCP/IP 模型中，网络核心部分功能简单、负载低。

实际上，数据传输的正确性与可靠性由传输层负责，这意味着相关处理压力被转移至“网络边缘设备（即主机）”。

### TCP/IP 各层功能

<img src="../images/image-202510141849.webp" style="zoom:80%;" />

<img src="../images/image-202510141852.webp" style="zoom:80%;" />
